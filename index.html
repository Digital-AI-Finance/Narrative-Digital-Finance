<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narrative Digital Finance | SNSF Research Project</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;font-size:13px;line-height:1.4;color:#334155;background:#f8fafc}
        a{color:#3b82f6;text-decoration:none}
        a:hover{text-decoration:underline}
        .navbar{position:fixed;top:0;left:0;right:0;height:40px;background:#0f172a;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 12px;z-index:1000}
        .navbar-brand{font-weight:700;font-size:14px;color:#fff;text-decoration:none}
        .navbar-brand span{color:#f59e0b}
        .navbar-nav{display:flex;list-style:none;gap:2px}
        .navbar-nav a{color:rgba(255,255,255,.8);padding:4px 8px;border-radius:4px;font-size:11px;font-weight:500}
        .navbar-nav a:hover{background:rgba(255,255,255,.1);text-decoration:none}
        .main{margin-top:40px}
        .hero{background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;padding:20px;text-align:center}
        .hero h1{font-size:24px;font-weight:700;margin-bottom:4px}
        .hero .sub{font-size:13px;opacity:.9;margin-bottom:8px}
        .hero-stats{display:flex;justify-content:center;gap:24px;margin:12px 0}
        .hero-stat{text-align:center}
        .hero-stat-val{font-size:20px;font-weight:700;color:#f59e0b}
        .hero-stat-lbl{font-size:10px;opacity:.7;text-transform:uppercase}
        .hero-badges{display:flex;justify-content:center;gap:6px;margin:8px 0}
        .hero-badges img{height:20px}
        .hero-btns{display:flex;justify-content:center;gap:8px}
        .btn{padding:6px 14px;border-radius:6px;font-size:11px;font-weight:600;text-decoration:none;display:inline-block}
        .btn-primary{background:#3b82f6;color:#fff}
        .btn-secondary{background:rgba(255,255,255,.15);color:#fff;border:1px solid rgba(255,255,255,.2)}
        .container{max-width:1100px;margin:0 auto;padding:12px}
        .grid{display:grid;gap:12px}
        .grid-2{grid-template-columns:repeat(2,1fr)}
        .grid-3{grid-template-columns:repeat(3,1fr)}
        .grid-4{grid-template-columns:repeat(4,1fr)}
        .grid-5{grid-template-columns:repeat(5,1fr)}
        .grid-6{grid-template-columns:repeat(6,1fr)}
        .section{background:#fff;border-radius:8px;padding:12px;margin-bottom:12px;border:1px solid #e2e8f0}
        .section-title{font-size:14px;font-weight:700;color:#0f172a;margin-bottom:8px;display:flex;align-items:center;gap:6px}
        .section-title::before{content:'';width:3px;height:14px;background:linear-gradient(180deg,#3b82f6,#f59e0b);border-radius:2px}
        .card{background:#f8fafc;border-radius:6px;padding:10px;border:1px solid #e2e8f0}
        .card h4{font-size:12px;font-weight:600;color:#0f172a;margin-bottom:4px}
        .card p{font-size:11px;color:#64748b}
        .team-card{text-align:center;padding:12px 8px}
        .team-avatar{width:48px;height:48px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:50%;margin:0 auto 6px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:14px}
        .team-card h4{font-size:11px;margin-bottom:2px}
        .team-card .role{color:#3b82f6;font-size:10px;font-weight:600}
        .team-card .aff{font-size:9px;color:#64748b}
        .team-metrics{display:flex;justify-content:center;gap:4px;margin-top:6px}
        .team-metric{background:#fff;border:1px solid #e2e8f0;border-radius:4px;padding:3px 6px;text-align:center}
        .team-metric-val{font-weight:700;color:#3b82f6;font-size:11px}
        .team-metric-lbl{font-size:8px;color:#64748b;text-transform:uppercase}
        .team-links{display:flex;justify-content:center;gap:4px;margin-top:6px;flex-wrap:wrap}
        .team-link{font-size:9px;padding:2px 6px;background:#e2e8f0;border-radius:3px;color:#334155}
        .stat-card{text-align:center;padding:10px;background:#f8fafc;border-radius:6px;border:1px solid #e2e8f0}
        .stat-num{font-size:22px;font-weight:700;color:#3b82f6}
        .stat-lbl{font-size:10px;color:#64748b}
        .output-card{text-align:center;padding:8px;background:#f8fafc;border-radius:6px;border:1px solid #e2e8f0}
        .output-icon{font-size:16px;margin-bottom:2px}
        .output-num{font-size:18px;font-weight:700;color:#0f172a}
        .output-lbl{font-size:9px;color:#64748b;text-transform:uppercase}
        .chart-box{background:#f8fafc;border-radius:6px;padding:10px;border:1px solid #e2e8f0}
        .chart-title{font-size:11px;font-weight:600;text-align:center;margin-bottom:6px;color:#0f172a}
        .topics{display:flex;flex-wrap:wrap;gap:4px}
        .topic{padding:3px 8px;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:12px;font-size:10px;color:#334155}
        .topic.lg{font-size:11px;font-weight:600}
        .highlight{background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff;border-radius:6px;padding:10px;margin:8px 0}
        .highlight h4{font-size:12px;margin-bottom:4px}
        .highlight p{font-size:11px;opacity:.9}
        .pub-controls{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}
        .pub-filters{display:flex;gap:6px;align-items:center}
        .pub-search,.pub-filter{padding:5px 8px;border:1px solid #e2e8f0;border-radius:4px;font-size:11px}
        .pub-search{width:160px}
        .pub-count{font-size:11px;color:#64748b}
        .refresh-btn{padding:5px 10px;background:#3b82f6;color:#fff;border:none;border-radius:4px;font-size:10px;font-weight:600;cursor:pointer}
        .pub-table{width:100%;border-collapse:collapse;font-size:11px}
        .pub-table th{background:#0f172a;color:#fff;padding:6px;text-align:left;font-weight:600;font-size:10px;cursor:pointer}
        .pub-table td{padding:6px;border-bottom:1px solid #e2e8f0;vertical-align:top}
        .pub-table tr:hover{background:#f8fafc}
        .pub-table .title-link{color:#0f172a;font-weight:500}
        .pub-table .authors{color:#64748b;font-size:10px}
        .pub-table .venue{font-style:italic;color:#64748b;font-size:10px}
        .citations-badge{display:inline-block;padding:2px 6px;background:#f1f5f9;border-radius:10px;font-size:10px;font-weight:600}
        .citations-badge.high{background:#3b82f6;color:#fff}
        .oa-badge{background:#10b981;color:#fff;padding:1px 4px;border-radius:3px;font-size:8px;font-weight:600}
        .doi-link{font-size:9px;color:#3b82f6}
        .timeline{padding-left:16px;border-left:2px solid #3b82f6}
        .timeline-item{padding:6px 0 6px 12px;position:relative}
        .timeline-item::before{content:'';position:absolute;left:-21px;top:10px;width:8px;height:8px;background:#3b82f6;border-radius:50%}
        .timeline-date{color:#3b82f6;font-weight:600;font-size:10px}
        .timeline-item h4{font-size:11px;margin:2px 0}
        .timeline-item p{font-size:10px;color:#64748b}
        .contact-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
        .contact-card{padding:10px;background:#f8fafc;border-radius:6px;border:1px solid #e2e8f0}
        .contact-card h4{font-size:11px;margin-bottom:4px}
        .contact-card p{font-size:10px;color:#64748b}
        .footer{background:#0f172a;color:#fff;padding:16px 12px;font-size:10px}
        .footer-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:12px}
        .footer h5{font-size:9px;text-transform:uppercase;letter-spacing:.05em;opacity:.5;margin-bottom:6px}
        .footer a{display:block;color:rgba(255,255,255,.8);padding:2px 0;font-size:10px}
        .footer-bottom{text-align:center;padding-top:12px;border-top:1px solid rgba(255,255,255,.1);opacity:.7;font-size:9px}
        @media(max-width:768px){.grid-2,.grid-3,.grid-4,.grid-5,.grid-6{grid-template-columns:1fr}.navbar-nav{display:none}.hero-stats{gap:12px}.footer-grid{grid-template-columns:repeat(2,1fr)}.contact-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="#" class="navbar-brand"><span>NDF</span> Narrative Digital Finance</a>
        <ul class="navbar-nav">
            <li><a href="#overview">Overview</a></li>
            <li><a href="#team">Team</a></li>
            <li><a href="#results">Results</a></li>
            <li><a href="#publications">Publications</a></li>
            <li><a href="#collaborations">Collaborations</a></li>
            <li><a href="#contact">Contact</a></li>
        </ul>
    </nav>

    <main class="main">
        <div class="hero">
            <h1>Narrative Digital Finance</h1>
            <p class="sub">A tale of structural breaks, bubbles & market narratives | SNSF Research Project</p>
            <div class="hero-stats">
                <div class="hero-stat"><div class="hero-stat-val">122</div><div class="hero-stat-lbl">Publications</div></div>
                <div class="hero-stat"><div class="hero-stat-val">2,010</div><div class="hero-stat-lbl">Citations</div></div>
                <div class="hero-stat"><div class="hero-stat-val">6</div><div class="hero-stat-lbl">Researchers</div></div>
                <div class="hero-stat"><div class="hero-stat-val">7</div><div class="hero-stat-lbl">Partners</div></div>
                <div class="hero-stat"><div class="hero-stat-val">CHF 236K</div><div class="hero-stat-lbl">Funding</div></div>
            </div>
            <div class="hero-badges">
                <a href="https://www.mysnf.ch/grants/grant.aspx?id=c8d8081e-6eee-4418-92bb-21dc2c89566a"><img src="https://img.shields.io/badge/SNSF-red?style=flat-square" alt="SNSF"></a>
                <a href="https://cordis.europa.eu/project/id/101119635"><img src="https://img.shields.io/badge/EU-Horizon-blue?style=flat-square" alt="EU"></a>
                <img src="https://img.shields.io/badge/2023--2026-Active-green?style=flat-square" alt="Active">
            </div>
            <div class="hero-btns">
                <a href="https://github.com/Digital-AI-Finance/Narrative-Digital-Finance" class="btn btn-primary">GitHub</a>
                <a href="https://github.com/Digital-AI-Finance/Narrative-Digital-Finance/wiki" class="btn btn-secondary">Wiki</a>
            </div>
        </div>

        <div class="container">
            <section id="overview" class="section">
                <div class="section-title">Project Overview</div>
                <p style="margin-bottom:8px">This project develops a comprehensive framework using advanced ML and NLP techniques to predict market outcomes, detect asset price bubbles, and identify structural breaks in financial markets.</p>
                <div class="topics">
                    <span class="topic lg">Machine Learning</span>
                    <span class="topic lg">NLP</span>
                    <span class="topic lg">Financial Markets</span>
                    <span class="topic">Sentiment Analysis</span>
                    <span class="topic">Credit Risk</span>
                    <span class="topic">Deep Learning</span>
                    <span class="topic">Bubble Detection</span>
                    <span class="topic">Structural Breaks</span>
                    <span class="topic">ESG</span>
                    <span class="topic">P2P Lending</span>
                    <span class="topic">XAI</span>
                    <span class="topic">Crypto</span>
                </div>
            </section>

            <section class="section">
                <div class="section-title">Research Highlights</div>
                <div class="highlight">
                    <h4>Featured: P2P Lending Credit Risk (Expert Systems with Applications, 2024)</h4>
                    <p>"Leveraging network topology for credit risk assessment in P2P lending" - Network features significantly improve credit scoring accuracy.</p>
                </div>
                <div class="grid grid-3">
                    <div class="card"><h4>Econometric Validation</h4><p>Validate models using real-world financial data from multiple markets</p></div>
                    <div class="card"><h4>Narrative Analysis</h4><p>Integrate text, speech, and media analysis for market prediction</p></div>
                    <div class="card"><h4>AI/ML Framework</h4><p>Detect market anomalies and forecast financial trends</p></div>
                </div>
            </section>

            <section id="team" class="section">
                <div class="section-title">Team (University of Twente & Bern Business School)</div>
                <div class="grid grid-6">
                    <div class="card team-card">
                        <div class="team-avatar">JO</div>
                        <h4>Joerg Osterrieder</h4>
                        <p class="role">Principal Investigator</p>
                        <p class="aff">BFH / UT</p>
                        <div class="team-metrics">
                            <div class="team-metric"><span class="team-metric-val">136</span><span class="team-metric-lbl">Works</span></div>
                            <div class="team-metric"><span class="team-metric-val">1153</span><span class="team-metric-lbl">Cites</span></div>
                            <div class="team-metric"><span class="team-metric-val">13</span><span class="team-metric-lbl">h</span></div>
                        </div>
                        <div class="team-links"><a href="https://orcid.org/0000-0003-0189-8636" class="team-link">ORCID</a><a href="https://scholar.google.com/citations?user=ocRaXoIAAAAJ" class="team-link">Scholar</a></div>
                    </div>
                    <div class="card team-card">
                        <div class="team-avatar" style="background:linear-gradient(135deg,#8b5cf6,#ec4899)">BH</div>
                        <h4>Branka Hadji Misheva</h4>
                        <p class="role">Team Member</p>
                        <p class="aff">BFH</p>
                        <div class="team-metrics">
                            <div class="team-metric"><span class="team-metric-val">42</span><span class="team-metric-lbl">Works</span></div>
                            <div class="team-metric"><span class="team-metric-val">380</span><span class="team-metric-lbl">Cites</span></div>
                            <div class="team-metric"><span class="team-metric-val">9</span><span class="team-metric-lbl">h</span></div>
                        </div>
                        <div class="team-links"><a href="https://orcid.org/0000-0001-7020-3469" class="team-link">ORCID</a></div>
                    </div>
                    <div class="card team-card">
                        <div class="team-avatar" style="background:linear-gradient(135deg,#10b981,#3b82f6)">GT</div>
                        <h4>Gabin Taibi</h4>
                        <p class="role">PhD Researcher</p>
                        <p class="aff">BFH / UT</p>
                        <div class="team-metrics">
                            <div class="team-metric"><span class="team-metric-val">1</span><span class="team-metric-lbl">Works</span></div>
                            <div class="team-metric"><span class="team-metric-val">1</span><span class="team-metric-lbl">Cites</span></div>
                        </div>
                    </div>
                    <div class="card team-card">
                        <div class="team-avatar" style="background:linear-gradient(135deg,#f59e0b,#ec4899)">LB</div>
                        <h4>Lennart John Baals</h4>
                        <p class="role">PhD Researcher</p>
                        <p class="aff">BFH / UT</p>
                        <div class="team-metrics">
                            <div class="team-metric"><span class="team-metric-val">14</span><span class="team-metric-lbl">Works</span></div>
                            <div class="team-metric"><span class="team-metric-val">125</span><span class="team-metric-lbl">Cites</span></div>
                            <div class="team-metric"><span class="team-metric-val">5</span><span class="team-metric-lbl">h</span></div>
                        </div>
                        <div class="team-links"><a href="https://www.linkedin.com/in/lennart-john-baals-a621aa193/" class="team-link">LinkedIn</a></div>
                    </div>
                    <div class="card team-card">
                        <div class="team-avatar" style="background:linear-gradient(135deg,#06b6d4,#3b82f6)">YL</div>
                        <h4>Yiting Liu</h4>
                        <p class="role">PhD Researcher</p>
                        <p class="aff">BFH / UT</p>
                        <div class="team-metrics">
                            <div class="team-metric"><span class="team-metric-val">12</span><span class="team-metric-lbl">Works</span></div>
                            <div class="team-metric"><span class="team-metric-val">351</span><span class="team-metric-lbl">Cites</span></div>
                            <div class="team-metric"><span class="team-metric-val">4</span><span class="team-metric-lbl">h</span></div>
                        </div>
                        <div class="team-links"><a href="https://orcid.org/0009-0006-9554-8205" class="team-link">ORCID</a></div>
                    </div>
                    <div class="card team-card">
                        <div class="team-avatar" style="background:linear-gradient(135deg,#64748b,#0f172a)">MK</div>
                        <h4>Marius Jan Klein</h4>
                        <p class="role">Team Member</p>
                        <p class="aff">BFH</p>
                    </div>
                </div>
            </section>

            <section id="results" class="section">
                <div class="section-title">Output & Results</div>
                <div class="grid grid-4" style="margin-bottom:8px">
                    <div class="stat-card"><div class="stat-num">122</div><div class="stat-lbl">Publications</div></div>
                    <div class="stat-card"><div class="stat-num">2,010</div><div class="stat-lbl">Citations</div></div>
                    <div class="stat-card"><div class="stat-num">13</div><div class="stat-lbl">Max h-index</div></div>
                    <div class="stat-card"><div class="stat-num">CHF 236K</div><div class="stat-lbl">SNSF Funding</div></div>
                </div>
                <div class="grid grid-5" style="margin-bottom:8px">
                    <div class="output-card"><div class="output-num">4</div><div class="output-lbl">Publications</div></div>
                    <div class="output-card"><div class="output-num">6</div><div class="output-lbl">Collaborations</div></div>
                    <div class="output-card"><div class="output-num">6</div><div class="output-lbl">Events</div></div>
                    <div class="output-card"><div class="output-num">4</div><div class="output-lbl">Knowledge Transfer</div></div>
                    <div class="output-card"><div class="output-num">3</div><div class="output-lbl">Awards</div></div>
                </div>
                <div class="grid grid-2">
                    <div class="chart-box"><div class="chart-title">Publications by Year</div><canvas id="pubsByYearChart" height="120"></canvas></div>
                    <div class="chart-box"><div class="chart-title">Citations by Year</div><canvas id="citationsByYearChart" height="120"></canvas></div>
                </div>
            </section>

            <section id="publications" class="section">
                <div class="section-title">Publications (OpenAlex)</div>
                <div class="pub-controls">
                    <div class="pub-filters">
                        <input type="text" class="pub-search" id="pubSearch" placeholder="Search...">
                        <select class="pub-filter" id="yearFilter"><option value="">All Years</option></select>
                        <select class="pub-filter" id="authorFilter"><option value="">All Authors</option></select>
                    </div>
                    <div style="display:flex;gap:8px;align-items:center">
                        <span class="pub-count" id="pubCount">Loading...</span>
                        <button class="refresh-btn" id="refreshBtn" onclick="refreshFromOpenAlex()">Refresh</button>
                    </div>
                </div>
                <div style="overflow-x:auto;border:1px solid #e2e8f0;border-radius:6px">
                    <table class="pub-table" id="pubTable">
                        <thead><tr>
                            <th onclick="sortTable(0)" style="width:50px">Year</th>
                            <th onclick="sortTable(1)">Title</th>
                            <th onclick="sortTable(2)" style="width:140px">Authors</th>
                            <th onclick="sortTable(3)" style="width:120px">Venue</th>
                            <th onclick="sortTable(4)" style="width:60px">Cites</th>
                            <th style="width:50px">Links</th>
                        </tr></thead>
                        <tbody id="pubTableBody"><tr><td colspan="6" style="text-align:center;padding:12px">Loading...</td></tr></tbody>
                    </table>
                </div>
            </section>

            <section id="collaborations" class="section">
                <div class="section-title">Collaborations</div>
                <div class="grid grid-2" style="margin-bottom:8px">
                    <div class="card"><h4>Deutsche Borse AG</h4><p>Dr. Stefan Schlamp - HFT & Market Microstructure</p></div>
                    <div class="card"><h4>Quoniam Asset Management</h4><p>Quantitative investment strategies</p></div>
                </div>
                <div class="grid grid-3" style="margin-bottom:8px">
                    <div class="card"><h4>Humboldt-University Berlin</h4><p>Financial econometrics</p></div>
                    <div class="card"><h4>American University of Sharjah</h4><p>Digital finance</p></div>
                    <div class="card"><h4>Babes-Bolyai University</h4><p>Quantitative finance</p></div>
                </div>
                <div class="grid grid-2">
                    <div class="card"><h4>COST Action CA19130</h4><p>Fintech and AI in Finance - Chair: J. Osterrieder</p></div>
                    <div class="card"><h4>MSCA Industrial Doctoral Network</h4><p>Digital Finance - Coordinator: J. Osterrieder</p></div>
                </div>
            </section>

            <section id="funding" class="section">
                <div class="section-title">Funding</div>
                <div class="grid grid-2">
                    <div class="card"><h4>Swiss National Science Foundation</h4><p>Grant: IZCOZ0_213370 | CHF 236,118 | 2023-2026</p></div>
                    <div class="card"><h4>Horizon Europe</h4><p>Marie Sklodowska-Curie Grant No. 101119635</p></div>
                </div>
            </section>

            <section class="section">
                <div class="section-title">News & Updates</div>
                <div class="timeline">
                    <div class="timeline-item"><div class="timeline-date">Dec 2024</div><h4>GitHub Repository Launched</h4><p>Project repo and wiki now available</p></div>
                    <div class="timeline-item"><div class="timeline-date">May 2024</div><h4>Expert Systems Publication</h4><p>P2P lending credit risk paper published</p></div>
                    <div class="timeline-item"><div class="timeline-date">Jan 2024</div><h4>Deutsche Borse Partnership</h4><p>HFT and market microstructure collaboration</p></div>
                    <div class="timeline-item"><div class="timeline-date">Jul 2023</div><h4>Project Launch</h4><p>SNSF funding started</p></div>
                </div>
            </section>

            <section id="contact" class="section">
                <div class="section-title">Contact</div>
                <div class="contact-grid">
                    <div class="contact-card"><h4>Principal Investigator</h4><p>Prof. Dr. Joerg Osterrieder<br>Bern Business School / University of Twente</p></div>
                    <div class="contact-card"><h4>Project Website</h4><p><a href="https://www.digital-finance-msca.com/snsf-narrative-digital-finance">digital-finance-msca.com</a></p></div>
                    <div class="contact-card"><h4>GitHub</h4><p><a href="https://github.com/Digital-AI-Finance/Narrative-Digital-Finance">Digital-AI-Finance</a></p></div>
                </div>
            </section>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="footer-grid">
                    <div><h5>Project</h5><a href="#overview">Overview</a><a href="#results">Results</a></div>
                    <div><h5>Team</h5><a href="#team">Members</a><a href="#collaborations">Collaborations</a></div>
                    <div><h5>Resources</h5><a href="#publications">Publications</a><a href="https://github.com/Digital-AI-Finance/Narrative-Digital-Finance/wiki">Wiki</a></div>
                    <div><h5>Funding</h5><a href="https://www.mysnf.ch/grants/grant.aspx?id=c8d8081e-6eee-4418-92bb-21dc2c89566a">SNSF</a><a href="https://cordis.europa.eu/project/id/101119635">EU CORDIS</a></div>
                </div>
                <div class="footer-bottom">Funded by EU (Grant No. 101119635) and SNSF | &copy; 2024 Narrative Digital Finance</div>
            </div>
        </footer>
    </main>

    <script>
        let publicationsData=[],allPublicationsData=[],sortDirection={};
        let pubsByYearChart,citationsByYearChart;

        function initCharts(pubs){
            const yearCounts={},citationsByYear={};
            pubs.forEach(p=>{const y=p.year||'Unknown';yearCounts[y]=(yearCounts[y]||0)+1;citationsByYear[y]=(citationsByYear[y]||0)+(p.cited_by_count||0)});
            const years=Object.keys(yearCounts).filter(y=>y!=='Unknown').sort();
            const counts=years.map(y=>yearCounts[y]),citations=years.map(y=>citationsByYear[y]);
            const ctx1=document.getElementById('pubsByYearChart').getContext('2d');
            if(pubsByYearChart)pubsByYearChart.destroy();
            pubsByYearChart=new Chart(ctx1,{type:'bar',data:{labels:years,datasets:[{data:counts,backgroundColor:'rgba(59,130,246,0.8)',borderRadius:4}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,grid:{color:'rgba(0,0,0,0.05)'}},x:{grid:{display:false}}}}});
            const ctx2=document.getElementById('citationsByYearChart').getContext('2d');
            if(citationsByYearChart)citationsByYearChart.destroy();
            citationsByYearChart=new Chart(ctx2,{type:'line',data:{labels:years,datasets:[{data:citations,borderColor:'#8b5cf6',backgroundColor:'rgba(139,92,246,0.1)',fill:true,tension:0.4,pointRadius:3}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,grid:{color:'rgba(0,0,0,0.05)'}},x:{grid:{display:false}}}}});
        }
        function populateFilters(pubs){
            const years=[...new Set(pubs.map(p=>p.year).filter(y=>y))].sort((a,b)=>b-a);
            const authors=[...new Set(pubs.flatMap(p=>p.team_member?[p.team_member]:[]))].sort();
            document.getElementById('yearFilter').innerHTML='<option value="">All Years</option>'+years.map(y=>`<option value="${y}">${y}</option>`).join('');
            document.getElementById('authorFilter').innerHTML='<option value="">All Authors</option>'+authors.map(a=>`<option value="${a}">${a}</option>`).join('');
        }
        function filterPublications(){
            const search=document.getElementById('pubSearch').value.toLowerCase();
            const year=document.getElementById('yearFilter').value;
            const author=document.getElementById('authorFilter').value;
            let filtered=allPublicationsData.filter(p=>{
                const matchSearch=!search||(p.title||'').toLowerCase().includes(search)||(p.authors_str||'').toLowerCase().includes(search);
                return matchSearch&&(!year||p.year==year)&&(!author||p.team_member===author);
            });
            publicationsData=filtered;
            renderPublications(filtered);
        }
        async function loadPublications(){
            try{
                const res=await fetch('data/publications.json');
                allPublicationsData=await res.json();
                publicationsData=[...allPublicationsData];
                renderPublications(publicationsData);
                initCharts(publicationsData);
                populateFilters(allPublicationsData);
            }catch(e){
                document.getElementById('pubTableBody').innerHTML='<tr><td colspan="6" style="text-align:center;padding:12px">Unable to load. Try Refresh.</td></tr>';
                document.getElementById('pubCount').textContent='0';
            }
        }
        function renderPublications(pubs){
            const tbody=document.getElementById('pubTableBody');
            document.getElementById('pubCount').textContent=pubs.length+' pubs';
            if(!pubs.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:12px">No results</td></tr>';return}
            tbody.innerHTML=pubs.map(p=>{
                const citeCls=p.cited_by_count>=10?'high':'';
                const doi=p.doi_url?`<a href="${p.doi_url}" class="doi-link" target="_blank">DOI</a>`:'';
                const oa=p.open_access?'<span class="oa-badge">OA</span>':'';
                const title=p.doi_url?`<a href="${p.doi_url}" class="title-link" target="_blank">${p.title||'Untitled'}</a>`:(p.title||'Untitled');
                return `<tr><td>${p.year||'-'}</td><td>${title}</td><td class="authors">${p.authors_str||'-'}</td><td class="venue">${p.venue||'-'}</td><td><span class="citations-badge ${citeCls}">${p.cited_by_count||0}</span></td><td>${doi} ${oa}</td></tr>`;
            }).join('');
        }
        function sortTable(col){
            const dir=sortDirection[col]==='asc'?'desc':'asc';
            sortDirection[col]=dir;
            const sorted=[...publicationsData].sort((a,b)=>{
                let va,vb;
                switch(col){case 0:va=a.year||0;vb=b.year||0;break;case 1:va=(a.title||'').toLowerCase();vb=(b.title||'').toLowerCase();break;case 2:va=(a.authors_str||'').toLowerCase();vb=(b.authors_str||'').toLowerCase();break;case 3:va=(a.venue||'').toLowerCase();vb=(b.venue||'').toLowerCase();break;case 4:va=a.cited_by_count||0;vb=b.cited_by_count||0;break;default:return 0}
                if(typeof va==='number')return dir==='asc'?va-vb:vb-va;
                return dir==='asc'?va.localeCompare(vb):vb.localeCompare(va);
            });
            renderPublications(sorted);
        }
        document.getElementById('pubSearch').addEventListener('input',filterPublications);
        document.getElementById('yearFilter').addEventListener('change',filterPublications);
        document.getElementById('authorFilter').addEventListener('change',filterPublications);

        const AUTHORS=[{name:'Joerg Osterrieder',search:'Joerg Osterrieder',minWorks:100},{name:'Branka Hadji Misheva',search:'Branka Hadji Misheva'},{name:'Gabin Taibi',search:'Gabin Taibi'},{name:'Lennart John Baals',search:'Lennart Baals'},{name:'Yiting Liu',search:'Yiting Liu'}];
        async function refreshFromOpenAlex(){
            const btn=document.getElementById('refreshBtn');
            btn.disabled=true;btn.textContent='Loading...';
            document.getElementById('pubTableBody').innerHTML='<tr><td colspan="6" style="text-align:center;padding:12px">Fetching from OpenAlex...</td></tr>';
            try{
                const allWorks=[],seenIds=new Set();
                for(const author of AUTHORS){
                    let url=`https://api.openalex.org/authors?search=${encodeURIComponent(author.search)}&per_page=5&mailto=web@example.com`;
                    if(author.minWorks)url+=`&filter=works_count:>${author.minWorks}`;
                    const aRes=await fetch(url);const aData=await aRes.json();
                    if(aData.results?.length){
                        const wRes=await fetch(`https://api.openalex.org/works?filter=authorships.author.id:${aData.results[0].id}&per_page=100&sort=publication_year:desc&mailto=web@example.com`);
                        const wData=await wRes.json();
                        if(wData.results)for(const w of wData.results)if(!seenIds.has(w.id)){seenIds.add(w.id);allWorks.push({id:w.id,title:w.title,year:w.publication_year,doi_url:w.doi,authors_str:w.authorships?.slice(0,5).map(a=>a.author?.display_name).join(', ')+(w.authorships?.length>5?'...':''),venue:w.primary_location?.source?.display_name||'',cited_by_count:w.cited_by_count||0,open_access:w.open_access?.is_oa||false,team_member:author.name})}
                    }
                }
                allWorks.sort((a,b)=>(b.year||0)-(a.year||0));
                allPublicationsData=allWorks;publicationsData=[...allWorks];
                renderPublications(publicationsData);initCharts(publicationsData);populateFilters(allPublicationsData);
            }catch(e){document.getElementById('pubTableBody').innerHTML='<tr><td colspan="6" style="text-align:center;padding:12px;color:red">Error. Try again.</td></tr>'}
            btn.disabled=false;btn.textContent='Refresh';
        }
        document.addEventListener('DOMContentLoaded',loadPublications);
    </script>
</body>
</html>
